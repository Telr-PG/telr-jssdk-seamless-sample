<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
    <title>Telr JS SDK Integration Sample</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="starter-template.css">
  </head>
  <body>
    <div class="container">

        <div class="starter-template">
            <h1>New Transaction</h1>
        </div>
        <div class="row">
            <form id="transaction_form" class="form-horizontal" method="POST" action="process.php">
                <input type="hidden" name="telr_token" id="telr_token" value="" />
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="store_id" class="col-sm-2 control-label">Store Id</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="store_id" id="store_id" placeholder="Store Id" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="auth_key" class="col-sm-2 control-label">Auth Key</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="auth_key" id="auth_key" placeholder="Auth Key" value="">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="amount" class="col-sm-2 control-label">Amount</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="amount" id="amount" placeholder="Amount" value="10">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="currency" class="col-sm-2 control-label">Currency</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="currency" id="currency" placeholder="Currency" value="SAR">
                        </div>
                    </div>
                </div>
                <h3>Billing Details</h3>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_fname" class="col-sm-2 control-label">First Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_fname" id="bill_fname" placeholder="First Name" value="John">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_sname" class="col-sm-2 control-label">Last Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_sname" id="bill_sname" placeholder="Last Name" value="Doe">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_addr1" class="col-sm-2 control-label">Address Line 1</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_addr1" id="bill_addr1" placeholder="Address Line 1" value="Test Address Line 1">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_addr2" class="col-sm-2 control-label">Address Line 2</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_addr2" id="bill_addr2" placeholder="Address Line 2" value="Test Address Line 2">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_city" class="col-sm-2 control-label">City</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_city" id="bill_city" placeholder="City" value="Mumbai">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_region" class="col-sm-2 control-label">Region/State</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_region" id="bill_region" placeholder="Region/State" value="Maharashtra">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_zip" class="col-sm-2 control-label">Zip Code</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_zip" id="bill_zip" placeholder="Zip Code" value="400001">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_country" class="col-sm-2 control-label">Country</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_country" id="bill_country" placeholder="Country" value="India">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_email" class="col-sm-2 control-label">Email Id</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_email" id="bill_email" placeholder="Email Id" value="support@telr.com">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="bill_tel" class="col-sm-2 control-label">Telephone</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="bill_tel" id="bill_tel" placeholder="Telephone" value="9820098200">
                        </div>
                    </div>
                </div>
                <h3>Repeat Billing with Telr Agreements</h3>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="repeat_amount" class="col-sm-2 control-label">Payment of</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="repeat_amount" id="repeat_amount" placeholder="Payment of" value="20">
                        </div>
                    </div>
                </div>


                <div class="col-md-6">
                    <div class="form-group">
                        <label for="repeat_final" class="col-sm-2 control-label">Final Payment</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="repeat_final" id="repeat_final" placeholder="Final Payment" value="30">
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="repeat_interval" class="col-sm-2 control-label">Every</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="repeat_interval" id="repeat_interval" placeholder="Every" value="1">
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <label for="repeat_period" class="col-sm-2 control-label"></label>
                        <div class="col-sm-10">
                            <select name="repeat_period" class="form-control">
                                <option value="M" selected>Months</option>
                                <option value="W">Weeks</option>
                            </select>
                        </div>
                    </div>
                </div>

                 <div class="col-md-6">
                    <div class="form-group">
                        <label for="repeat_term" class="col-sm-2 control-label">No of Payments</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="repeat_term" id="repeat_term" placeholder="No of Payments" value="5">
                        </div>
                    </div>
                </div>

                <div class="col-md-12">
                    <!-- Placeholder for rendering card input fields -->
                    <div id="telr_frame"></div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <div class="col-md-12 text-center">
                            <button type="submit" id="submit_form" class="btn btn-primary">Proceed to Pay</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://secure.telr.com/jssdk/v2/telr_sdk.js"></script>
    
    <script type="text/javascript">
        var onTokenReceive = function(telrToken){
            /* Include the received card token from iframe in payment form & send as ivp_ctoken parameter */
            // console.log("Telr Token Received: " + telrToken); // Uncomment for debugging purposes
            $("#telr_token").val(telrToken);
        };

        var telr_params = {
            store_id : 12345,
            currency: "AED",
            test_mode: 1,
            /*  Uncomment and fill in the values to render saved card option */
            // saved_cards: [
            //     {
            //         "txn_id" : "",
            //         "name" : ""
            //     }
            // ],
            callback: onTokenReceive
        };

        telrSdk.init(telr_params);

        $(document).ready(function(){
            var form = $("#transaction_form");

            $("#submit_form").click(function(e){
                e.preventDefault();

                if($("#telr_token").val() == ""){
                    alert("Please fill the complete card details");
                    e.preventDefault();
                    return false;
                }else{
                    $("#submit_form").html("Please Wait...");
                    $("#submit_form").attr("disabled", "disabled");                
                    $.ajax({
                        type: form.attr("method"),
                        url: form.attr("action"),
                        data: form.serialize(),
                        success: function (data) {
                            var result=JSON.parse(data);
                            $("#telr_iframe").attr("src", result.redirect_link); 
                            $("#submit_form").html("Proceed to Pay");
                            $("#submit_form").removeAttr("disabled");
                        }
                    });
                    return false;
                }
            });
        });
    </script>
  </body>
</html>
